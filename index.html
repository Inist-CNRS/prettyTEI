<!DOCTYPE html>
<html>
    <head>
        <title>Pretty TEI demo</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="dist/css/bootstrap-theme.min.css">

        <!-- html Style -->
        <link rel="stylesheet" href="dist/css/style.css">

        <!-- TEI LESS generated Style -->
        <link rel="stylesheet" href="css/tei.css">
    </head>
    <body>
        <div class="container">
            <h1 class="col-lg-12">Drag & Drop your TEI files to watch them with prettyTEI:</h1>
            <div class="row">
                <div class="col-sm-2"></div>

                <section id="uploadDiv" class="col-sm-8">
                    <div id="dropArea" draggable='true'>Drag & drop files here</div>
                </section>

                <section id="listDiv" class="col-sm-12">
                </section>
            </div>
        </div>
  
        <script src="http//code.jquery.com/jquery-1.11.2.min.js"></script>
        <script src="dist/js/bootstrap.min.js"></script>
        <script>


            /*
            * dropArea is the drag & drop zone
            * listDiv is the section to watch sended elements
            * nbOfFiles is an int incremented when send a file
            */
            var dropArea = $('#dropArea'),
                listDiv = $("#listDiv"),
                nbOfFiles = 0;

            function readFile(file,nbOfFiles) {
                    // Loop through files with a closure so every FileReader are isolated.
                    var reader = new FileReader();
                    reader.onload = function(event) { 
                            // get file content , name
                            var name = file.name;
                            var text = event.target.result; 

                            //create figure & div modal 
                            var figure = $('<figure class="figureFile col-sm-3"></figure>'),
                                div = '<div class="modal fade" id="fileContent'+ nbOfFiles +'" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">\
                              <div class="modal-dialog teiModal">\
                                <div class="modal-content">\
                                  <div class="modal-header">\
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\
                                    <h4 class="modal-title" id="myModalLabel">'+ name +'</h4>\
                                  </div>\
                                  <div class="modal-body tei">\
                                    '+ text +'\
                                  </div>\
                                  <div class="modal-footer">\
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\
                                  </div>\
                                </div>\
                              </div>\
                            </div>';

                            // Add img & figcaption (file name) to figure
                            figure.append('<img src="dist/img/xml.jpg" class="pictures" alt="xml picture" data-toggle="modal" data-target="#fileContent'+ nbOfFiles +'">','<figcaption>'+ name +'</figcaption>');

                            // Add all created elements to html
                            listDiv.append(figure);
                            listDiv.append(div)

                        }
                        reader.readAsText(file, "UTF-8");
                        
            };


            dropArea.bind({
              // Effect on dragover
              dragover: function() {
                $(this).addClass('hover');
                return false;
              },
              // Remove Class on dragleave
              dragleave: function() {
                $(this).removeClass('hover');
                return false;
              },
              //Function when drop file(s)
              drop: function(e) {
                $(this).removeClass('hover');
                e = e || window.event;
                e.preventDefault();

                e = e.originalEvent || e;
           
                var files = (e.files || e.dataTransfer.files);

                // For every file
                for (var i = 0; i < files.length; i++) {
                    readFile(files[i],nbOfFiles);
                    nbOfFiles++;
                }
            }
        });
        //$(".js-tei").append("<div class='tei'></div>").children("div.tei").load("tei/test.xml");
        </script>
    </body>
</html>
